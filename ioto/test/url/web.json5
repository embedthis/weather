/*
    web.json5 - Web server configuration file for testing
*/
{
    log: {
        path: 'log.txt',
        format: '%S: %T: %M',
        types: 'error,info,trace',
        sources: 'all,!mbedtls',
        _show: '',
    },
    tls: {
        authority: '../certs/ca.crt',
        certificate: '../certs/test.crt',
        key: '../certs/test.key',
        renegotiate: true,
        ticket: true,
        verify: {
            client: true,
            issuer: true,
        },
    },
    web: {
        documents: './site',
        headers: {
            'Access-Control-Allow-Origin': '*',
            'Access-Control-Allow-Methods': 'GET, POST',
            'Access-Control-Allow-Headers': 'content-type, authorization',
            'Access-Control-Allow-Credentials': 'true',
            'Access-Control-Allow-Max-Age': '86400',
            'X-Content-Type-Options': 'nosniff',
            'X-Frame-Options': 'SAMEORIGIN',
            'X-XSS-Protection': '1; mode=black',
            'Referrer-Policy': 'same-origin',
        },
        limits: {
            body: '100K',
            connections: '100',
            header: '10K',
            sessions: '20',
            upload: '20MB',
            maxFrame: '100K',
            maxMessage: '100K',
        },
        listen: ['http://localhost:3890', 'https://localhost:3891'],
        index: 'index.html',
        auth: {
            realm: 'Test Realm',
            authType: 'digest',
            algorithm: 'SHA-256',
            secret: 'test-secret-1234567890abcdef',
            autoLogin: false,
            requireTlsForBasic: false,
            roles: {
                public: [],
                user: ['view', 'read'],
                admin: ['user', 'edit', 'delete'],
            },
            // This authentication is for test purposes only. NEVER ship this configuration.
            users: {
                alice: {
                    // password: 'password' (SHA-256 hash with prefix)
                    password: 'SHA256:11c66702489123a02c7dd0860e47fc4989bb0805ba5835fbbb36f316ec83eb83',
                    role: 'admin'
                },
                bob: {
                    // password: 'password' (MD5 hash with prefix)
                    password: 'MD5:123b28ffae9fdec0c8e4b9dc92deb9bc',
                    role: 'user'
                },
            },
            login: '/api/public/login',
            logout: '/api/public/logout',
        },
        routes: [
            //  Basic authentication routes
            { match: '/basic/', authType: 'basic', role: 'user', handler: 'file' },

            //  Digest authentication routes (SHA-256 by default)
            { match: '/digest/', authType: 'digest', role: 'user', handler: 'file' },

            //  MD5 digest authentication (legacy)
            { match: '/digest-md5/', authType: 'digest', algorithm: 'MD5', role: 'user', handler: 'file' },

            //  Admin-only area (requires admin role)
            { match: '/admin/', authType: 'digest', role: 'admin', handler: 'file' },

            //  Trailing "/" matches prefix only
            { match: '/test/', handler: 'action', methods: ['GET', 'POST', 'PUT', 'DELETE', 'HEAD', 'OPTIONS', 'TRACE', 'PATCH'] },
            { match: '/upload/', methods: ['DELETE', 'GET', 'PUT'] },
            { match: '/trace/', methods: ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT', 'TRACE'], trim: '/trace' },
            { match: '/stream/', trim: '/stream', stream: true, handler: 'action' },
            { /* Catch all */ },
        ],
        timeouts: {
            parse: '60 secs',
            inactivity: '300 secs',
            request: '10 mins',
            session: '30 mins'
        },
        webSockets: {
            ping: 'never',
            protocol: 'chat',
            validateUTF: false,
        },
        upload: {
            dir: 'tmp',
        },
    },
}
